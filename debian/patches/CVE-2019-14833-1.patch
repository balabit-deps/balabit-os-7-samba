From 49bc425fb9589908ab8401934d7a2d60ac1f1a12 Mon Sep 17 00:00:00 2001
From: Andrew Bartlett <abartlet@samba.org>
Date: Thu, 19 Sep 2019 11:50:01 +1200
Subject: [PATCH 1/2] CVE-2019-14833: Use utf8 characters in the unacceptable
 password

This shows that the "check password script" handling has a bug.

BUG: https://bugzilla.samba.org/show_bug.cgi?id=12438
Signed-off-by: Andrew Bartlett <abartlet@samba.org>
---
 selftest/knownfail.d/unacceptable-passwords | 1 +
 selftest/target/Samba4.pm                   | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)
 create mode 100644 selftest/knownfail.d/unacceptable-passwords

Index: samba-4.7.6+dfsg~ubuntu/selftest/knownfail.d/unacceptable-passwords
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ samba-4.7.6+dfsg~ubuntu/selftest/knownfail.d/unacceptable-passwords	2019-10-18 08:47:58.107466997 -0400
@@ -0,0 +1 @@
+^samba.tests.samba_tool.user_check_password_script.samba.tests.samba_tool.user_check_password_script.UserCheckPwdTestCase.test_checkpassword_unacceptable\(chgdcpass:local\)
\ No newline at end of file
Index: samba-4.7.6+dfsg~ubuntu/selftest/target/Samba4.pm
===================================================================
--- samba-4.7.6+dfsg~ubuntu.orig/selftest/target/Samba4.pm	2019-10-18 08:47:58.111467013 -0400
+++ samba-4.7.6+dfsg~ubuntu/selftest/target/Samba4.pm	2019-10-18 08:47:58.107466997 -0400
@@ -1895,7 +1895,7 @@ sub provision_chgdcpass($$)
 	my $extra_provision_options = undef;
 	# This environment disallows the use of this password
 	# (and also removes the default AD complexity checks)
-	my $unacceptable_password = "widk3Dsle32jxdBdskldsk55klASKQ";
+	my $unacceptable_password = "Paßßword-widk3Dsle32jxdBdskldsk55klASKQ";
 	push (@{$extra_provision_options}, "--dns-backend=BIND9_DLZ");
 	my $ret = $self->provision($prefix,
 				   "domain controller",
